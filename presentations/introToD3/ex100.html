<!doctype html>
<html>
<head></head>
<body>
  <h1>Learning about the call-stack and call-site in JavaScript.</h1>
  <script>
    // Illustrates the call-site and call-stack
    function baz() {
      // call-stack is `baz`
      // call-site is in the global scope
      console.log("baz");
      bar(); // call-site for `bar`
    }
    function bar() {
      // call-stack is `baz`->`bar`
      // call-site is in the `baz`
      console.log("bar");
      foo();
    }
    function foo() {
      // call-stack is `baz`->`bar`->`foo`
      // call-site is in the `bar`
      //debugger;
      console.log("foo");
    }
    baz();

    // Default binding to the global scope
    // using strict will prohibit default binding
    function qux() {
      console.log( this.a );
    }
    var a = 2;
    qux();

    // Illustrates the implicit binding
    // obj owns or contains the function reference to quux function
    function quux() {
      //debugger;
      // obj is this for the quux
      console.log( this.a );
    }
    var obj = {
      a: 5,
      quux: quux
    };
    obj.quux();

    // Implicit binding, object chaining
    // Only the top/last level matters
    function corge() {
      //debugger;
      console.log( this.a );
    }
    var obj2 = {
      a: 42,
      corge: corge
    };
    var obj1 = {
      a: 3,
      obj2: obj2
    };
    obj1.obj2.corge();

    // Implicitly lost (falls back to default binding or undefined (if strict))
    function grault() {
      //debugger;
      console.log( this.a );
    }
    var obj3 = {
      a: 47,
      grault: grault
    };
    var garply = obj3.grault; // function reference / alias
    var a = "opps, global"; // `a` property on global object
    garply(); // "opps, global"

    // Explicit binding using call()
    // Does not solve the "loosing this reference" problem
    function waldo() {
      console.log( this.a );
    }
    var obj4 = {
      a: 7
    };
    waldo.call( obj4 );

    // Hard binding (pattern around explicit binding)
    // This solves the "loosing this reference" problem
    function fred() {
      debugger;
      console.log( this.a );
    }
    var obj5 = {
      a: 1
    };
    var plugh = function() {
      fred.call( obj5 );
    }
    plugh();
    setTimeout( plugh, 100 );
    // plugh hard binds fred's this to obj5
    // it cannot be overriden!
    plugh.call( window );
  </script>
</body>
</html>
